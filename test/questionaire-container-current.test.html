<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Questionaire Container current() Method Tests</title>
    <script type="importmap">
    {
      "imports": {
        "lit": "https://unpkg.com/lit@3.3.1/index.js",
        "lit/": "https://unpkg.com/lit@3.3.1/",
        "@lit/reactive-element": "https://unpkg.com/@lit/reactive-element@2.1.1/reactive-element.js",
        "@lit/reactive-element/": "https://unpkg.com/@lit/reactive-element@2.1.1/",
        "lit-html": "https://unpkg.com/lit-html@3.3.1/lit-html.js",
        "lit-html/": "https://unpkg.com/lit-html@3.3.1/",
        "lit-element": "https://unpkg.com/lit-element@4.2.1/lit-element.js",
        "lit-element/": "https://unpkg.com/lit-element@4.2.1/"
      }
    }
    </script>
    <script type="module" src="../src/questionaire-container.js"></script>
    <script type="module" src="../src/questionaire-question-answer.js"></script>
    <script type="module" src="../src/questionaire-question.js"></script>
    <script type="module" src="../src/questionaire-question-content.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test.pass {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .test.fail {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .test-result {
            font-size: 14px;
        }
        #summary {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border: 2px solid #333;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-elements {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Questionaire Container current() Method Tests</h1>
    <div id="summary">
        <div>Total: <span id="total">0</span></div>
        <div>Passed: <span id="passed">0</span></div>
        <div>Failed: <span id="failed">0</span></div>
    </div>
    <div id="test-results"></div>

    <!-- Test elements (hidden) -->
    <div class="test-elements">
        <!-- Test container 1: Basic questions -->
        <questionaire-container id="test-container-1">
            <questionaire-question id="question-1" name="q1">
                <questionaire-question-content>Question 1 Content</questionaire-question-content>
                <questionaire-question-answer value="a">Answer A</questionaire-question-answer>
            </questionaire-question>
            <questionaire-question id="question-2" name="q2">
                <questionaire-question-content>Question 2 Content</questionaire-question-content>
                <questionaire-question-answer value="b">Answer B</questionaire-question-answer>
            </questionaire-question>
            <questionaire-question id="question-3" name="q3">
                <questionaire-question-content>Question 3 Content</questionaire-question-content>
                <questionaire-question-answer value="c">Answer C</questionaire-question-answer>
            </questionaire-question>
        </questionaire-container>

        <!-- Test container 2: Mixed content types -->
        <questionaire-container id="test-container-2">
            <questionaire-question id="mixed-q1" name="mixed1">
                <questionaire-question-content>Mixed Question 1</questionaire-question-content>
                <questionaire-question-answer value="m1">Mixed Answer 1</questionaire-question-answer>
            </questionaire-question>
            <div id="mixed-div">Non-question element</div>
            <questionaire-question id="mixed-q2" name="mixed2">
                <questionaire-question-content>Mixed Question 2</questionaire-question-content>
                <questionaire-question-answer value="m2">Mixed Answer 2</questionaire-question-answer>
            </questionaire-question>
        </questionaire-container>

        <!-- Test container 3: Empty container -->
        <questionaire-container id="test-container-3">
        </questionaire-container>

        <!-- Test container 4: Single element -->
        <questionaire-container id="test-container-4">
            <questionaire-question id="single-question" name="single">
                <questionaire-question-content>Single Question</questionaire-question-content>
                <questionaire-question-answer value="single">Single Answer</questionaire-question-answer>
            </questionaire-question>
        </questionaire-container>
    </div>

    <script type="module">
        const results = document.getElementById('test-results');
        let passed = 0;
        let failed = 0;
        let total = 0;

        function assert(condition, message) {
            if (!condition) {
                throw new Error(message || 'Assertion failed');
            }
        }

        function assertEquals(actual, expected, message) {
            if (actual !== expected) {
                throw new Error(message || `Expected ${JSON.stringify(expected)} but got ${JSON.stringify(actual)}`);
            }
        }

        function runTest(name, testFn) {
            total++;
            const testDiv = document.createElement('div');
            testDiv.className = 'test';
            const nameDiv = document.createElement('div');
            nameDiv.className = 'test-name';
            nameDiv.textContent = name;
            testDiv.appendChild(nameDiv);

            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result';

            try {
                testFn();
                testDiv.classList.add('pass');
                resultDiv.textContent = '✓ PASS';
                passed++;
            } catch (e) {
                testDiv.classList.add('fail');
                resultDiv.textContent = '✗ FAIL: ' + e.message;
                failed++;
            }

            testDiv.appendChild(resultDiv);
            results.appendChild(testDiv);
        }

        async function runTests() {
            await new Promise(resolve => setTimeout(resolve, 200));
            
            const container1 = document.getElementById('test-container-1');
            const container2 = document.getElementById('test-container-2');
            const container3 = document.getElementById('test-container-3');
            const container4 = document.getElementById('test-container-4');

            runTest('current() method should exist', () => {
                assert(typeof container1.current === 'function', 'current should be a function');
            });

            runTest('current() should return first element initially', () => {
                // Container should start at index 0
                assertEquals(container1.currentIndex, 0, 'Should start at index 0');
                
                const current = container1.current();
                assert(current !== null, 'Current should not be null');
                assertEquals(current.id, 'question-1', 'Should return first question element');
            });

            runTest('current() should return correct element after navigation', () => {
                // Navigate to second slide
                container1.next();
                
                const current = container1.current();
                assertEquals(current.id, 'question-2', 'Should return second question after next()');
                
                // Navigate to third slide
                container1.next();
                
                const current2 = container1.current();
                assertEquals(current2.id, 'question-3', 'Should return third question after second next()');
            });

            runTest('current() should return correct element after goToSlide', () => {
                // Go directly to first slide
                container1.goToSlide(0);
                
                const current = container1.current();
                assertEquals(current.id, 'question-1', 'Should return first question after goToSlide(0)');
                
                // Go directly to third slide
                container1.goToSlide(2);
                
                const current2 = container1.current();
                assertEquals(current2.id, 'question-3', 'Should return third question after goToSlide(2)');
            });

            runTest('current() should work with mixed content types', () => {
                // First element should be a question
                const current1 = container2.current();
                assertEquals(current1.id, 'mixed-q1', 'Should return first question');
                
                // Navigate to second element (div)
                container2.next();
                const current2 = container2.current();
                assertEquals(current2.id, 'mixed-div', 'Should return div element');
                
                // Navigate to third element (question)
                container2.next();
                const current3 = container2.current();
                assertEquals(current3.id, 'mixed-q2', 'Should return second question');
            });

            runTest('current() should return null for empty container', () => {
                const current = container3.current();
                assertEquals(current, null, 'Should return null for empty container');
            });

            runTest('current() should work with single element container', () => {
                const current = container4.current();
                assertEquals(current.id, 'single-question', 'Should return single question element');
            });

            runTest('current() should return live element reference', () => {
                const current = container1.current();
                
                // Modify element through current() return value
                const originalClassName = current.className;
                current.className = 'test-modified-class';
                
                // Verify it's the same element in DOM
                const domElement = document.getElementById(current.id);
                assertEquals(domElement.className, 'test-modified-class', 'Should be live reference to DOM element');
                
                // Restore original class
                current.className = originalClassName;
            });

            runTest('current() should update when currentIndex changes', () => {
                // Start at known position
                container1.goToSlide(0);
                let current = container1.current();
                assertEquals(current.id, 'question-1', 'Should start at question 1');
                
                // Navigate multiple times
                container1.next();
                current = container1.current();
                assertEquals(current.id, 'question-2', 'Should update to question 2');
                
                container1.previous();
                current = container1.current();
                assertEquals(current.id, 'question-1', 'Should update back to question 1');
            });

            runTest('current() should return questionaire-question elements correctly', () => {
                container1.goToSlide(0);
                const current = container1.current();
                
                assertEquals(current.tagName, 'QUESTIONAIRE-QUESTION', 'Should return question element');
                assert('name' in current, 'Should have name property');
                assert('value' in current, 'Should have value property');
                assert(typeof current.validate === 'function', 'Should have validate method');
            });

            runTest('current() should handle boundary conditions', () => {
                // Test at first slide
                container1.goToSlide(0);
                let current = container1.current();
                assertEquals(current.id, 'question-1', 'Should work at first slide');
                
                // Test at last slide
                container1.goToSlide(container1.slideCount - 1);
                current = container1.current();
                assertEquals(current.id, 'question-3', 'Should work at last slide');
                
                // Try to go beyond last slide (should stay at last)
                container1.next();
                current = container1.current();
                assertEquals(current.id, 'question-3', 'Should stay at last slide when going beyond');
            });

            runTest('current() should work with existing container methods', () => {
                // Verify that adding current() doesn't break existing functionality
                assert(typeof container1.next === 'function', 'next method should still exist');
                assert(typeof container1.previous === 'function', 'previous method should still exist');
                assert(typeof container1.goToSlide === 'function', 'goToSlide method should still exist');
                assert(typeof container1.slideCount === 'number', 'slideCount should still work');
                assert(typeof container1.getContents === 'function', 'getContents method should still exist');
                assert(typeof container1.values === 'object', 'values property should still work');
                
                // Test that current() doesn't affect navigation
                const initialIndex = container1.currentIndex;
                const current = container1.current();
                assertEquals(container1.currentIndex, initialIndex, 'current() should not change currentIndex');
            });

            // Update summary
            document.getElementById('total').textContent = total;
            document.getElementById('passed').textContent = passed;
            document.getElementById('failed').textContent = failed;

            console.log(`Tests complete: ${passed}/${total} passed`);
        }

        // Run tests after all components are ready
        Promise.all([
            customElements.whenDefined('questionaire-container'),
            customElements.whenDefined('questionaire-question'),
            customElements.whenDefined('questionaire-question-content'),
            customElements.whenDefined('questionaire-question-answer')
        ]).then(runTests);
    </script>
</body>
</html>